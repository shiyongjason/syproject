<template>
    <div class="page-body">
        <div class="page-body-cont query-cont">
            <h2>2019年线下台账导入</h2>
            <div class="query-cont-col">
                <a class="downloadExcel" href="/excelTemplate/资金台账-还款信息导入模板.xls" download="资金台账-还款信息导入模板.xls">
                    还款明细表模板导出
                </a>
            </div>
            <div class="query-cont-col">
                <a class="downloadExcel" href="/excelTemplate/资金台账-借款信息导入模板.xlsx" download="资金台账-借款信息导入模板.xlsx">
                    借款模板导出
                </a>
            </div>
            <div class="query-cont-col">
                <el-upload class="upload-demo" :show-file-list="false" :headers='headersData' :action="interfaceUrl + 'backend/api/account/import'" :on-success="isSuccess" :on-error="isError" :before-upload="handleUpload" auto-upload>
                    <el-button type="primary" class='m0' :loading='loading'>
                        借款信息导入
                    </el-button>
                </el-upload>
            </div>
            <div class="query-cont-col">
                <el-upload class="upload-demo" :show-file-list="false" :headers='headersData' :action="interfaceUrl + 'backend/api/account/repay/import'" :on-success="isSuccess" :on-error="isError" :before-upload="handleUpload" auto-upload>
                    <el-button type="primary" class="m0" :loading='loading'>
                        还款明细表信息导入
                    </el-button>
                </el-upload>
            </div>
        </div>
    </div>
</template>

<script>
import { interfaceUrl } from '@/api/config'
import { mapState } from 'vuex'
export default {
    name: 'brandSale',
    data: function () {
        return {
            interfaceUrl: interfaceUrl,
            accept: '.xlsx,.xls',
            loading: false,
            headersData: {
                'refreshToken': sessionStorage.getItem('refreshToken'),
                'Authorization': 'Bearer ' + sessionStorage.getItem('token')
            }
        }
    },
    computed: {
        ...mapState({
            userInfo: state => state.userInfo
        })
    },
    methods: {
        isSuccess (response) {
            this.$message({
                message: '批量导入成功！',
                type: 'success'
            })
            this.loading = false
        },
        isError (response) {
            this.$message({
                message: '批量导入失败，' + JSON.parse(response.message).message,
                type: 'error'
            })
            this.loading = false
        },
        handleUpload (file) {
            if (file.size / (1024 * 1024) > 100) {
                this.$message({
                    message: '附件要保持100M以内',
                    type: 'warning'
                })
                return false
            }
            const fileSuffix = file.name.substring(file.name.lastIndexOf('.'))
            if (this.accept.lastIndexOf(fileSuffix) == -1) {
                this.$message.error('格式不正确！')
                return false
            }
            this.loading = true
        }
    },
    async mounted () {

    }
}
</script>

<style lang="scss" scoped>
.downloadExcel {
    padding: 12px 20px;
    border-radius: 4px;
    background-color: #ff7a45;
    color: #fff;
}
    h2 {
        line-height: 50px;
        margin-bottom: 50px;
    }
    .page-body-cont {
        padding-bottom: 30px;
    }
</style>
