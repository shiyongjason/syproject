<template>
    <el-drawer title="é¡¹ç›®è¯¦æƒ…" :visible.sync="drawer" :before-close="handleClose" :modal-append-to-body='false' size='680px' >
        <div class="ProjectList2Detail">
            <div class="radio-group">
                <el-radio-group v-model="radio">
                    <el-radio-button label="è·Ÿè¿›è®°å½•"></el-radio-button>
                    <el-radio-button label="é¡¹ç›®ä¿¡æ¯"></el-radio-button>
                </el-radio-group>
            </div>
            <!--  -->
            <div class="ProjectList2Detail-ctx" :style="radio=='è·Ÿè¿›è®°å½•'?'bottom:0':'bottom:60px'">
                <div v-if="radio=='è·Ÿè¿›è®°å½•'">
                    <div>
                        <b>é¡¹ç›®ç±»å‹ï¼š</b>é¡¹ç›®æ¤å…¥ä¾›åº”é“¾äº§å“
                    </div>
                    <!-- æµç¨‹ -->
                    <div class="process" style="height:138px">
                        <div class="process-item isActive">é¦–æ¬¡æ¥è§¦</div>
                        <div class="step_arrow"></div>
                        <div class="process-item isActive">éœ€æ±‚ç¡®è®¤</div>
                        <div class="step_arrow"></div>
                        <div class="process-item isActive">æä¾›æ–¹æ¡ˆ/æŠ¥ä»·</div>
                        <div class="step_arrow"></div>
                        <div class="process-item isActive">å•†åŠ¡æ´½è°ˆï¼Œå¾…ç­¾çº¦</div>
                        <div class="step_arrow down"></div>
                        <div class="process-item pos5">å·²ç­¾çº¦</div>
                        <div class="step_arrow left"></div>
                        <div class="process-item pos6">å·²å›æ¬¾</div>
                        <div class="step_arrow left pos7"></div>
                        <div class="process-item pos8">æ— éœ€è·Ÿè¿›</div>
                    </div>
                    <h-button type='assist' @click='add'> + æ–°å¢è·Ÿè¿›è®°å½•</h-button>
                    <div style="margin-top:20px">
                        <b>è·Ÿè¿›åŠ¨æ€</b>
                    </div>
                    <div class="follow-records">
                        <div class="follow-cell">
                            <div class="info"><img src="" class="avatar">
                                <div class="name-container">
                                    <div class="follow-tag">è·Ÿè¿›äºº</div>
                                    <div class="name">ç‹å°äºŒxxxxxxxx</div>
                                </div>
                                <div class="time">2021/06/10 11:20</div>
                            </div>
                            <div class="content-container">
                                <div class="line"></div>
                                <div class="content">
                                    <div class="title-tag" >è¯­éŸ³é€šè¯</div>
                                    <div class="audio-player-container">
                                        <div class="crm-audio-player" >
                                            <audio controls>
                                                <source src="https://hosjoy-oss-test.oss-cn-hangzhou.aliyuncs.com/files/temp/2021-06-17/14288512729326857274_1623833656365_external5072153392980475027.amr" type="audio/mpeg">
                                                æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒ éŸ³é¢‘ æ’ä»¶ï¼Œè¯·ä½¿ç”¨è°·æ­Œæµè§ˆå™¨ã€‚
                                            </audio>
                                        </div>
                                    </div>
                                    <div class="watch-audio-text" >æŸ¥çœ‹è¯­éŸ³æ–‡æœ¬</div>
                                    <div class="desc">xxxxxxxxæ‚¨æ”¶åˆ°æˆ‘ä»¬çš„æ ·å“ç®±äº†ï¼Œä½¿ç”¨ä¸­æœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿæ‚¨æ”¶åˆ°æˆ‘ä»¬çš„æ ·å“ç®±äº†ï¼Œä½¿ç”¨ä¸­æœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ</div>
                                </div>
                            </div>
                        </div>
                        <div class="follow-cell">
                            <div class="info"><img src="" class="avatar">
                                <div class="name-container">
                                    <div class="follow-tag">è·Ÿè¿›äºº2</div>
                                    <div class="name">ç‹å°äºŒxxxxxxxx</div>
                                </div>
                                <div class="time">2021/06/10 11:20</div>
                            </div>
                            <div class="content-container">
                                <div class="line"></div>
                                <div class="content">
                                    <div class="title-tag" >å½“é¢æ‹œè®¿</div>
                                    <div class="audio-player-container">
                                        <div class="crm-audio-player" >
                                            <el-image style="width: 100px; height: 100px;margin-right:5px" :src="url" :preview-src-list="srcList"></el-image>
                                            <el-image style="width: 100px; height: 100px;margin-right:5px" :src="url" :preview-src-list="srcList"></el-image>
                                            <el-image style="width: 100px; height: 100px;margin-right:5px" :src="url" :preview-src-list="srcList"></el-image>
                                            <el-image style="width: 100px; height: 100px;margin-right:5px" :src="url" :preview-src-list="srcList"></el-image>
                                            <el-image style="width: 100px; height: 100px;margin-right:5px" :src="url" :preview-src-list="srcList"></el-image>
                                            <el-image style="width: 100px; height: 100px;margin-right:5px" :src="url" :preview-src-list="srcList"></el-image>
                                            <el-image style="width: 100px; height: 100px;margin-right:5px" :src="url" :preview-src-list="srcList"></el-image>
                                            <el-image style="width: 100px; height: 100px;margin-right:5px" :src="url" :preview-src-list="srcList"></el-image>
                                        </div>
                                    </div>
                                    <div style="margin-top:10px">è·Ÿè¿›èŠ‚ç‚¹<font style="margin-left:52px;">æä¾›æ–¹æ¡ˆ/æŠ¥ä»·</font></div>
                                    <div style="margin-top:10px;display: flex;"><font style="flex:0 0 58px">è·Ÿè¿›å†…å®¹</font><span style="margin-left:50px;">ä¸Šé—¨æ‹œè®¿ï¼Œå¹¶è¿›è¡Œäº§å“æ¼”ç¤ºï¼Œéœ€å¸¦æ ·å“ç®±ä¸Šé—¨æ‹œè®¿ï¼Œå¹¶è¿›è¡Œäº§å“æ¼”ç¤ºï¼Œéœ€å¸¦æ ·å“ç®±ä¸Šé—¨æ‹œè®¿ï¼Œå¹¶è¿›è¡Œäº§å“æ¼”ç¤ºï¼Œéœ€å¸¦æ ·å“ç®±ä¸Šé—¨æ‹œè®¿ï¼Œå¹¶è¿›è¡Œäº§å“æ¼”ç¤ºï¼Œéœ€å¸¦æ ·å“ç®±</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div v-if="radio=='é¡¹ç›®ä¿¡æ¯'" class="project-information">
                    <el-form id='elform' :model="projectDetail" :rules="formRules"  label-width="140px"  label-position='right' ref="projectDetailForm" class="list2">
                        <div class="project-detail-item">
                            <el-form-item  prop='firstPartName' label="ç”²æ–¹åç§°ï¼š">
                                <el-input  placeholder="è¯·è¾“å…¥ç”²æ–¹åç§°" v-model='projectDetail.firstPartName'></el-input>
                            </el-form-item>
                        </div>
                        <div class="project-detail-item">
                            <el-form-item  prop='projectName' label="é¡¹ç›®åç§°ï¼š">
                                <el-input  placeholder="è¯·è¾“å…¥é¡¹ç›®åç§°" v-model='projectDetail.projectName'></el-input>
                            </el-form-item>
                        </div>
                        <div class="project-detail-item">
                            <el-form-item prop='projectBuildingTypeList' label="">
                                <div slot="label" style="line-height: 20px;">é¡¹ç›®å»ºç­‘ç±»å‹<br/>ï¼ˆå¯å¤šé€‰ï¼‰ï¼š</div>
                                <el-select v-model="projectDetail.projectBuildingTypeList" multiple placeholder="è¯·é€‰æ‹©">
                                    <el-option v-for="item in projectBuildingType" :key="item.value" :label="item.value" :value="Number(item.key)"></el-option>
                                </el-select>
                            </el-form-item>
                        </div>
                        <div class="project-detail-item">
                            <el-form-item prop='projectRoleList' label="">
                                <div slot="label" style="line-height: 20px;"><font style="padding-right:10px">é¡¹ç›®è§’è‰²</font><br/>ï¼ˆå¯å¤šé€‰ï¼‰ï¼š</div>
                                <el-select v-model="projectDetail.projectRoleList" multiple placeholder="è¯·é€‰æ‹©">
                                    <el-option v-for="item in projectRole" :key="item.value" :label="item.value" :value="Number(item.key)"></el-option>
                                </el-select>
                            </el-form-item>
                        </div>
                        <div class="project-detail-item">
                            <el-form-item prop='projectStep' label="">
                                <div slot="label">é¡¹ç›®æ‰€å¤„çš„é˜¶æ®µï¼š</div>
                                <el-select v-model="projectDetail.projectStep" placeholder="è¯·é€‰æ‹©">
                                    <el-option v-for="item in projectStep" :key="item.value" :label="item.value" :value="Number(item.key)"></el-option>
                                </el-select>
                            </el-form-item>
                        </div>
                        <div class="project-detail-item">
                            <el-form-item  label="">
                                <div slot="label" style="line-height: 20px;"><font>å¯ä»æ€»éƒ¨é‡‡è´­äº§å“</font><br/>ï¼ˆå¯å¤šé€‰ï¼‰ï¼š</div>
                                <el-select v-model="projectDetail.generalGoodsList" multiple placeholder="è¯·é€‰æ‹©">
                                    <el-option v-for="item in generalGoods" :key="item.value" :label="item.value" :value="Number(item.key)"></el-option>
                                </el-select>
                            </el-form-item>
                        </div>
                        <div class="project-detail-item">
                            <el-form-item  label="">
                                <div slot="label" style="line-height: 20px;"><font>å·¥ç¨‹é¡¹ç›®æ™ºèƒ½åŒ–éœ€æ±‚</font><br/>ï¼ˆå¯å¤šé€‰ï¼‰ï¼š</div>
                                <el-select v-model="projectDetail.projectIntelligentNeedsList" multiple placeholder="è¯·é€‰æ‹©">
                                    <el-option v-for="item in projectIntelligentNeeds" :key="item.value" :label="item.value" :value="Number(item.key)"></el-option>
                                </el-select>
                            </el-form-item>
                        </div>
                        <div class="form-item">
                            <el-form-item  label="é¡¹ç›®é¢„è®¡äº¤ä»˜æ—¶é—´ï¼š">
                                <el-date-picker v-model="projectDetail.estimatedDeliverTime" type="date" placeholder="é€‰æ‹©æ—¥æœŸ" value-format="yyyy-MM-dd"></el-date-picker>
                            </el-form-item>
                        </div>
                    </el-form>
                    <div style="color:#606266;line-height:40px"><font class="project-detail-others">åˆ›å»ºæ—¶é—´ï¼š</font>{{projectDetail.createTime | formatDate('YYYYå¹´MMæœˆDDæ—¥ HH:mm:ss')}}</div>
                    <div style="color:#606266;line-height:40px"><font class="project-detail-others">åˆ›å»ºäººï¼š</font>{{projectDetail.createBy}}ï¼ˆ-------ï¼‰</div>
                    <div style="color:#606266;line-height:40px"><font class="project-detail-others">æœ€è¿‘ç»´æŠ¤æ—¶é—´ï¼š</font>{{projectDetail.updateTime | formatDate('YYYYå¹´MMæœˆDDæ—¥ HH:mm:ss')}}</div>
                    <div style="color:#606266;line-height:40px;margin-bottom:20px"><font class="project-detail-others">æœ€è¿‘ç»´æŠ¤äººï¼š</font>{{projectDetail.updateBy || '-'}} (-------)</div>
                </div>

            </div>
            <div class="bottom-line" v-if="radio=='é¡¹ç›®ä¿¡æ¯'"></div>
            <div class="fixed-btn" v-if="radio=='é¡¹ç›®ä¿¡æ¯'"><h-button type="primary" @click="onUpDateProjectDetail">ä¿å­˜</h-button></div>
            <!-- æ·»åŠ è·Ÿè¿›è®°å½• -->
            <el-dialog title="æ·»åŠ è·Ÿè¿›è®°å½•" class="record-dialog" :visible.sync="addRecord" :modal='false' width="800px">
                <div class="record-layout">
                    <div class="header-title">
                        <el-radio-group v-model="radioRecord">
                            <el-radio label="å½“é¢æ‹œè®¿">å½“é¢æ‹œè®¿</el-radio>
                            <el-radio label="ç”µè¯/å¾®ä¿¡æ²Ÿé€š/é‚®ä»¶ç­‰">ç”µè¯/å¾®ä¿¡æ²Ÿé€š/é‚®ä»¶ç­‰</el-radio>
                        </el-radio-group>
                        <p class="tips">æ¸©é¦¨æç¤ºï¼šæ¨èä½¿ç”¨ä¼ä¸šå¾®ä¿¡ä¸å®¢æˆ·èŠå¤©ï¼Œè‡ªåŠ¨æ›´æ–°è®°å½•ï¼Œæ›´æ–¹ä¾¿ã€‚</p>
                    </div>
                    <div style="margin-top:-10px">
                        <el-form :rules="formRules">
                            <div class="record-dialog-item" v-if="radioRecord==='å½“é¢æ‹œè®¿'">
                                <el-form-item  prop='name' label="ä¸Šä¼ ç°åœºå›¾ç‰‡ï¼š"></el-form-item>
                                <div style="margin-top:-20px">
                                    <OssFileHosjoyUpload :showPreView=true  v-model="projectDetail.upload" :fileSize=20 :action='action' :uploadParameters='uploadParameters' style="margin:10px 0 0 5px" accept=".jpg,.jpeg,.png">
                                    <div class="a-line">
                                        <el-button type="primary" size="mini"><i class="el-icon-upload file-icon"></i> ä¸Šä¼ æ–‡ä»¶</el-button>
                                    </div>
                                    </OssFileHosjoyUpload>
                                </div>
                            </div>
                            <div class="record-dialog-item">
                                <el-form-item  prop='name' label="å®¢æˆ·è”ç³»äººï¼š" class="textarea">
                                    <el-input  placeholder="è¯·é€‰æ‹©å®¢æˆ·è”ç³»äºº" suffix-icon="el-icon-arrow-right" @focus="onOpenContactVisible"></el-input>
                                </el-form-item>
                            </div>
                            <div class="record-dialog-item">
                                <el-form-item  prop='name' label="è·Ÿè¿›èŠ‚ç‚¹ ï¼š  "  class="textarea">
                                    <el-select v-model="projectDetail.name" multiple placeholder="è¯·é€‰æ‹©">
                                        <el-option v-for="item in intelligentdemand" :key="item.value" :label="item.label" :value="item.value"></el-option>
                                    </el-select>
                                    <el-input v-model="projectDetail.name" placeholder="è¯·è¾“å…¥æ— éœ€æ›´è¿›åŸå› " style="width:380px;margin-left:17px" type="textarea" maxlength="200" show-word-limit rows='2'></el-input>
                                </el-form-item>
                            </div>
                            <div class="record-dialog-item">
                                <el-form-item  prop='name' label="è·Ÿè¿›å†…å®¹ï¼š"  class="textarea">
                                    <el-input v-model="projectDetail.name" placeholder="è¯·è¾“å…¥æ­¤æ¬¡è·Ÿè¿›ç»“æœ/ä¸‹æ¬¡è·Ÿè¿›äº‹é¡¹" style="width:380px;" type="textarea" maxlength="200" show-word-limit rows='2'></el-input>
                                </el-form-item>
                            </div>
                            <div class="record-dialog-item">
                                <el-form-item  label="ä¸‹æ¬¡è·Ÿè¿›æ—¶é—´ï¼š"  class="textarea">
                                    <el-date-picker v-model="projectDetail.name" type="datetime" value-format='yyyy-MM-ddTHH:mm:ss'  placeholder="é€‰æ‹©æ—¥æœŸ"></el-date-picker>
                                </el-form-item>
                            </div>
                            <div class="record-dialog-item">
                                <el-form-item  label="é‚€è¯·åŒäº‹ååŠ©ï¼š" class="textarea">
                                    <el-input  placeholder="è¯·é€‰æ‹©åŒäº‹ååŠ©" suffix-icon="el-icon-arrow-right" @focus="onOpenHelp"></el-input>
                                </el-form-item>
                                <p class="tips" style="margin-top:-10px;margin-left:120px">åŒäº‹å°†ååŠ©ä½ è§£å†³å®¢æˆ·çš„é—®é¢˜ï¼Œæ›´å¿«ä¿ƒæˆäº¤ã€‚</p>
                            </div>
                            <div class="record-dialog-item">
                                <el-form-item  label="éœ€ååŠ©å†…å®¹ï¼š" class="textarea">
                                    <el-input  placeholder="è¯·è¾“å…¥éœ€ååŠ©å†…å®¹" type="textarea" maxlength="200" show-word-limit rows='2'></el-input>
                                </el-form-item>
                            </div>
                            <div class="record-dialog-item" v-if="radioRecord!=='å½“é¢æ‹œè®¿'">
                                <el-form-item  prop='name' label="é™„ä»¶ï¼ˆä¸è¶…è¿‡8ä¸ªï¼‰ï¼š"></el-form-item>
                                <div style="margin-top:-20px">
                                    <OssFileHosjoyUpload :showPreView=true  v-model="projectDetail.upload" :fileNum=8 :fileSize=20 :action='action' :uploadParameters='uploadParameters' style="margin:10px 0 0 5px" accept=".jpg,.jpeg,.png">
                                    <div class="a-line">
                                        <el-button type="primary" size="mini"><i class="el-icon-upload file-icon"></i> ä¸Šä¼ æ–‡ä»¶</el-button>
                                    </div>
                                    </OssFileHosjoyUpload>
                                </div>
                            </div>
                            <div class="record-dialog-item">
                                <el-form-item  label="å…¶ä»–å¤‡æ³¨ï¼š" class="textarea">
                                    <el-input  placeholder="å…¶ä»–éœ€ç‰¹æ®Šè¯´æ˜äº‹é¡¹å¯æ·»åŠ " type="textarea" maxlength="200" show-word-limit rows='2'></el-input>
                                </el-form-item>
                            </div>
                        </el-form>
                    </div>
                </div>
                <!-- å†…åµŒå¼¹çª—-é€‰æ‹©è”ç³»äºº -->
                <el-dialog width="700px" title="é€‰æ‹©è”ç³»äºº" :visible.sync="innerContactVisible" append-to-body>
                    <div class="contact">
                        <div class="contact-item">
                            <el-checkbox v-model="radioContact"></el-checkbox>
                            <div class="checkbox-right">æœªç›´æ¥è”ç³»å®¢æˆ·ï¼Œå·²ä¸å®¢æˆ·ç»ç†æ²Ÿé€š</div>
                        </div>
                        <div style="margin:-10px 0 8px"><b>å‘˜å·¥åˆ—è¡¨</b></div>
                        <div class="contact-item">
                            <el-checkbox v-model="radioContact"></el-checkbox>
                            <div class="checkbox-right iborder"><i class="el-icon-user-solid"></i>å¼ ä¸‰ï¼ˆ18994003028ï¼‰<span>è€æ¿ï¼Œæ“ç›˜æ‰‹</span></div>
                        </div>
                        <div class="contact-item">
                            <el-checkbox v-model="radioContact"></el-checkbox>
                            <div class="checkbox-right iborder"><i class="el-icon-user-solid"></i>å¼ ä¸‰ï¼ˆ18994003028ï¼‰<span>è€æ¿ï¼Œæ“ç›˜æ‰‹</span></div>
                        </div>
                        <!--  -->
                        <div style="margin-bottom:15px">
                            <b>å®¢æˆ·ç»ç†æ·»åŠ çš„è”ç³»äºº</b>  <el-button type="primary" size="mini" style="margin-left:10px"> + æ·»åŠ ä¼ä¸šæ–°çš„è”ç³»äºº</el-button>
                        </div>
                        <!-- user -->
                        <div class="contact-item" style="margin-bottom:0px">
                            <el-checkbox v-model="radioContact" style="margin-top:3px"></el-checkbox>
                            <div class="checkbox-right">
                                <div class="contact-table">
                                    <div class="contact-table-item">
                                        <font style="color:#ff0000;">*</font>å®¢æˆ·å§“å<el-input placeholder="è¯·è¾“å…¥" v-model='projectDetail.name' size="mini" class="contact-table-item-input"></el-input>
                                    </div>
                                    <div class="contact-table-item">
                                        <font style="color:#ff0000;">*</font>æ‰‹æœºå·<el-input placeholder="è¯·è¾“å…¥" v-model='projectDetail.name' size="mini" class="contact-table-item-input" style="width:110px"></el-input>
                                    </div>
                                    <div class="contact-table-item">
                                        <font style="color:#ff0000;">*</font>è§’è‰²
                                        <el-select v-model="projectDetail.name" multiple placeholder="è¯·é€‰æ‹©" class="contact-table-item-input" size="mini">
                                            <el-option v-for="item in buildingType" :key="item.value" :label="item.label" :value="item.value"></el-option>
                                        </el-select>
                                    </div>
                                    <div class="contact-table-item">
                                        <el-button type="primary" size="mini">åˆ é™¤</el-button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- end -->
                    </div>
                    <div slot="footer" class="dialog-footer">
                        <el-button @click="innerContactVisible = false">å– æ¶ˆ</el-button>
                        <el-button type="primary" @click="innerContactVisible = false">ç¡®å®š</el-button>
                    </div>
                </el-dialog>
                <!-- å†…åµŒå¼¹çª—-é‚€è¯·åŒäº‹ååŠ© -->
                <el-dialog width="450px" title="é‚€è¯·åŒäº‹ååŠ©" :visible.sync="innerHelpVisible" append-to-body>
                    <div class="innerHelp-layout">
                        <div class="search-input">
                            <el-autocomplete v-model="stateN" :fetch-suggestions="querySearchAsync" placeholder="è¯·è¾“å…¥åŒäº‹å§“åæŸ¥è¯¢" :trigger-on-focus="false" @select="handleSelect"  @keyup.enter.native="findOrganizationEmployee">
                                <template slot-scope="{ item }">
                                    <div class="autoflex">
                                        <div class="name">{{ item.psnname }}</div>
                                        <span class="addr">{{ item.deptName }}</span>
                                    </div>
                                </template>
                            </el-autocomplete>
                            <el-button type="primary" @click="findOrganizationEmployee" style="margin-left:20px">æŸ¥è¯¢</el-button>
                        </div>
                        <div class="innerHelp-ctx">
                            <div class="helper-list">
                                å·²é€‰æ‹©ï¼š
                                <div class="helper-list-box">
                                    <div class="user"><span><font class="el-icon-remove removeicon"></font>å­™å†›</span><span>UEDéƒ¨é—¨</span></div>
                                    <div class="user"><span><font class="el-icon-remove removeicon"></font>æ¨å¤§å¤§</span><span>UEDéƒ¨é—¨</span></div>
                                    <div class="user"><span><font class="el-icon-remove removeicon"></font>å¼ ä¸‰ä¸‰</span><span>UEDéƒ¨é—¨Déƒ¨é—¨</span></div>
                                    <div class="user"><span><font class="el-icon-remove removeicon"></font>å­™å†›</span><span>UEDéƒ¨é—¨</span></div>
                                    <div class="user"><span><font class="el-icon-remove removeicon"></font>å­™å†›</span><span>UEDéƒ¨é—¨</span></div>
                                    <div class="user"><span><font class="el-icon-remove removeicon"></font>å­™å†›</span><span>UEDéƒ¨é—¨</span></div>
                                    <div class="user"><span><font class="el-icon-remove removeicon"></font>å­™å†›</span><span>UEDéƒ¨é—¨</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div slot="footer" class="dialog-footer">
                        <el-button @click="innerContactVisible = false">å– æ¶ˆ</el-button>
                        <el-button type="primary" @click="innerContactVisible = false">ç¡®å®š</el-button>
                    </div>
                </el-dialog>
                <div slot="footer" class="dialog-footer">
                    <el-button @click="outerVisible = false">å– æ¶ˆ</el-button>
                    <el-button type="primary" @click="innerContactVisible = true">ç¡®å®š</el-button>
                </div>
            </el-dialog>
        </div>

    </el-drawer>
</template>
<script lang="ts">
import { Vue, Component, Prop, Watch } from 'vue-property-decorator'
import OssFileHosjoyUpload from '@/components/OssFileHosjoyUpload/OssFileHosjoyUpload.vue'
import { ccpBaseUrl, ossAliyun, ossOldBucket } from '@/api/config'
import OssFileUtils from '@/utils/OssFileUtils'
import { Action, Getter } from 'vuex-class'
import { ReqProjectSupply } from '@/interface/hbp-member'
import { DictionaryList, upDateProjectDetail } from './api'
import { validateForm } from '@/decorator'

@Component({
    name: 'ProjectList2Detail',
    components: { OssFileHosjoyUpload }
})
export default class ProjectList2Detail extends Vue {
    @Prop({ type: Boolean, required: true, default: false }) drawer: boolean;
    @Prop({ type: Object, required: true }) projectDetail: ReqProjectSupply;
    @Prop({ type: Object, required: true }) formRules: any;

    @Action('vipApply/findContract') findContract: Function
    @Getter('vipApply/contracts') contracts: any
    @Getter('projectStore/projectIntelligentNeeds') projectIntelligentNeeds: DictionaryList
    @Getter('projectStore/projectBuildingType') projectBuildingType: DictionaryList
    @Getter('projectStore/projectStep') projectStep: DictionaryList
    @Getter('projectStore/projectRole') projectRole: DictionaryList
    @Getter('projectStore/generalGoods') generalGoods: DictionaryList
    @Getter('projectStore/refundPayType') refundPayType: DictionaryList

    action = ccpBaseUrl + 'common/files/upload-old'
    uploadParameters = {
        updateUid: '',
        reservedName: false
    }

    radio: string = 'è·Ÿè¿›è®°å½•';
    radioRecord: string = 'å½“é¢æ‹œè®¿';
    // æ·»åŠ è·Ÿè¿›è®°å½• å¼¹çª—
    addRecord:boolean = false
    // é€‰æ‹©è”ç³»äºº å¼¹çª—
    innerContactVisible:boolean = false
    // é‚€è¯·åŒäº‹ååŠ© å¼¹çª—
    innerHelpVisible:boolean = false
    radioContact:string = ''
    stateN = ''
    url = 'https://fuss10.elemecdn.com/e/5d/4a731a90594a4af544c0c25941171jpeg.jpeg'
    srcList = [
        'https://fuss10.elemecdn.com/8/27/f01c15bb73e1ef3793e64e6b7bbccjpeg.jpeg',
        'https://fuss10.elemecdn.com/8/27/f01c15bb73e1ef3793e64e6b7bbccjpeg.jpeg'
    ]

    queryParams = {
        keyWord: ''
    }
    timeout = null

    change (val) {
        console.log('ğŸš€ --- change --- val', val)
    }

    handleClose () {
        let projectDetailForm:any = this.$refs['projectDetailForm']
        if (projectDetailForm) {
            projectDetailForm.resetFields()
        }
        this.$emit('handleClose')
    }
    add () {
        this.addRecord = true
    }
    onOpenContactVisible () {
        this.innerContactVisible = true
    }
    onOpenHelp () {
        this.innerHelpVisible = true
    }

    // é¢„è§ˆæ–‡ä»¶
    async handleLink (fileUrl) {
        let tokenUrl = await OssFileUtils.getUrl(fileUrl)
        if (tokenUrl.indexOf(ossOldBucket + '.') === -1) {
            tokenUrl = ossAliyun + tokenUrl.replace(OssFileUtils.hostReg, '')
        }
        window.open(tokenUrl)
    }

    handleDelFile (index, fileList) {
        fileList.splice(index, 1)
    }

    async querySearchAsync (queryString, cb) {
        if (queryString) {
            await this.findContract(queryString)
            var restaurants = this.contracts
            var results = queryString ? restaurants.filter(this.createStateFilter(queryString)) : restaurants
            clearTimeout(this.timeout)
            this.timeout = setTimeout(() => {
                cb(results)
            }, 3000 * Math.random())
        }
    }
    createStateFilter (queryString) {
        return (state) => {
            return (state.psnname.indexOf(queryString) === 0)
        }
    }
    handleSelect (item) {
        console.log('ğŸš€ --- handleSelect --- item', item)
        this.stateN = item.psnname
        console.log('ğŸš€ --- handleSelect --- this.stateN ', this.stateN)
        // if (this.dialogVisible) {
        //     this.stateN = item.psnname
        //     this.stateItem = item
        //     this.ruleForm.assignedUserId = item.psncode
        // } else {
        //     this.stateUser = item.psnname
        //     this.stateItem = item
        //     this.queryParams.assignedUserId = item.psncode
        // }
    }

    findOrganizationEmployee () {
        console.log(' ğŸš— ğŸš• ğŸš™ ğŸšŒ ğŸš findOrganizationEmployee')
    }

    @validateForm('projectDetailForm')
    async onUpDateProjectDetail () {
        await upDateProjectDetail(this.projectDetail)
        this.$message.success('ä¿å­˜æˆåŠŸ')
        this.$emit('getDetail', this.projectDetail.id)
    }

    mounted () {
        console.log(' ğŸš— ğŸš• ğŸš™ ğŸšŒ ğŸš ', this.projectDetail)
    }
}
</script>
<style lang='scss' scoped>
@import "./css/detail.scss";
</style>