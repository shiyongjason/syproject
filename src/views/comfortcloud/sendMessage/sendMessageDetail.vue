<template>
    <div class="page-body">
        <div class="title">
            统计说明
            <el-tooltip class="item" effect="dark" placement="right-start">
                <span>?</span>
                <div slot="content">
                    目标用户：计划发送消息的目标用户的数量<br/>送达用户：消息实际下发到应用的数量<br/>打开用户：用户打开消息通知的消息数量<br/>清除用户：用户清除消息通知的消息数量
                </div>
            </el-tooltip>
        </div>
        <div class="container page-body-cont">
            <div class="wrapper-chart">
                <div class="time">
                    {{cloudSendMessageDetailChart.pushTime | momentFormat('YYYY-MM-DD')}} - {{ Date.now() |
                    momentFormat('YYYY-MM-DD')}}
                </div>
                <div class="chart" ref="barChart" style="width: 580px;height: 400px"></div>
            </div>
            <div class="tips">
                <div class="sub-title">
                    消息详情
                </div>
                <div>
                    <p>
                        消息主题：{{cloudSendMessageDetailChart.theme}}
                    </p>
                    <p>
                        目标用户：
                        <span v-if="cloudSendMessageDetailChart.target == 1">所有用户</span>
                        <span v-if="cloudSendMessageDetailChart.target == 2">有效家庭的管理员</span>
                    </p>
                    <p>
                        消息通知内容：{{cloudSendMessageDetailChart.content}}
                    </p>
                    <p>
                        点击后打开：{{cloudSendMessageDetailChart.clickRedirect}}
                    </p>
                    <p>
                        推送时间：{{cloudSendMessageDetailChart.pushTime | momentFormat}}
                    </p>
                </div>
            </div>
        </div>
    </div>
</template>

<script>
import echarts from 'echarts'
import { mapActions, mapGetters } from 'vuex'

const barOption = {
    xAxis: {
        type: 'category',
        data: ['目标用户', '送达用户', '打开用户', '清除用户']
    },
    yAxis: {
        type: 'value',
        name: '单位：人次'
    },
    tooltip: {
        trigger: 'axis',
        axisPointer: {
            lineStyle: {
                color: '#ddd'
            }
        },
        padding: [5, 10],
        textStyle: {
            color: '#ffffff'
        },
        extraCssText: 'box-shadow: 0 0 5px rgba(0,0,0,0.3)'
    },
    series: {
        data: [],
        type: 'bar',
        showBackground: true,
        backgroundStyle: {
            color: '#00ccff'
        },
        itemStyle: {
            normal: {
                color: '#00ccff'
            }
        },
        markPoint: {
            data: [
                {
                    name: '送达率',
                    value: 0,
                    xAxis: 1,
                    yAxis: 0,
                    itemStyle: {
                        color: '#00ccff'
                    }
                },
                {
                    name: '打开率',
                    value: 0,
                    xAxis: 2,
                    yAxis: 0,
                    itemStyle: {
                        color: '#00ccff'
                    }
                }
            ],
            label: {
                color: '#ffffff',
                fontSize: 10
            }
        }
    }
}
export default {
    name: 'sendMessageDetail',
    data () {
        return {
            id: ''
        }
    },
    computed: {
        ...mapGetters({
            cloudSendMessageDetailChart: 'cloudSendMessageDetailChart'
        })
    },
    methods: {
        ...mapActions({
            findCloudSendMessageDetailChart: 'findCloudSendMessageDetailChart',
            findCloudAlarmChart: 'findCloudAlarmChart'
        })
    },
    async mounted () {
        // getCloudSendMessageDetailChart
        this.id = this.$route.query.id
        await this.findCloudSendMessageDetailChart({ id: this.id })
        barOption.series.data = [
            this.cloudSendMessageDetailChart.pushCount,
            this.cloudSendMessageDetailChart.receivedCount,
            this.cloudSendMessageDetailChart.openedCount,
            this.cloudSendMessageDetailChart.deletedCount
        ]
        barOption.series.markPoint.data[0].value =
            this.cloudSendMessageDetailChart.receivedPercent + '%'
        barOption.series.markPoint.data[0].yAxis = this.cloudSendMessageDetailChart.receivedCount
        barOption.series.markPoint.data[1].value =
            this.cloudSendMessageDetailChart.openedPercent + '%'
        barOption.series.markPoint.data[1].yAxis = this.cloudSendMessageDetailChart.openedCount
        echarts.init(this.$refs.barChart).setOption(barOption)
    }
}
</script>

<style scoped lang="scss">
    .title {
        padding: 20px 12px;

        span {
            border: 1px solid #666666;
            border-radius: 50%;
            color: #666666;
            width: 16px;
            height: 16px;
            display: inline-block;
            text-align: center;
            font-size: 12px;
            cursor: pointer;
        }
    }

    .container {
        display: flex;

        .wrapper-chart {
            margin: 20px;
        }

        .sub-title {
            padding: 20px 0;
            font-weight: 500;
            font-size: 16px;
        }

        p {
            padding: 6px;
            font-size: 14px;
            color: #666666;
            font-weight: 200;
            line-height: 17px;
            box-sizing: border-box;
        }
    }
</style>
